@using Microsoft.CodeAnalysis.CSharp.Syntax
@model GitMonitor.Models.MonitoredPath
<div class="row">
    <div class="col-md-offset-1 col-md-10">
        <div class="panel panel-default">
            <div class="panel-body">
                Days:
                <a asp-controller="Home" asp-action="Index" asp-route-days="1"><span class="badge">1</span></a>
                <a asp-controller="Home" asp-action="Index" asp-route-days="3"><span class="badge">3</span></a>
                <a asp-controller="Home" asp-action="Index" asp-route-days="7"><span class="badge">7</span></a>
                <a asp-controller="Home" asp-action="Index" asp-route-days="14"><span class="badge">14</span></a>
                <a asp-controller="Home" asp-action="Index" asp-route-days="30"><span class="badge">30</span></a>
                <a asp-controller="Home" asp-action="Index" asp-route-days="90"><span class="badge">90</span></a>
                <a asp-controller="Home" asp-action="Fetch" class="btn btn-success btn-xs">Fetch All</a>
            </div>
        </div>
        <div class="bs-component">
            @if (Model != null)
            {
                <ul class="nav nav-pills" id="myTab">
                    <li class="active"><a href="#allcommits" data-toggle="tab"><small>All - @Model.Commits.Count</small></a></li>
                    @foreach (var repo in @Model.Repositories)
                    {
                        if (repo.CommitCount > 0)
                        {
                            <li><a href="#@repo.FriendlyName" data-toggle="tab"><small>@repo.FriendlyName - @repo.CommitCount</small></a></li>
                        }
                    }
                </ul>
                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade active in" id="allcommits">
                        <table class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th>Repository</th>
                                <th>Date</th>
                                <th>User</th>
                                <th>Commit</th>
                                <th class="col-md-12">Message</th>
                            </tr>
                            </thead>
                            <tbody>
                            @foreach (var commit in @Model.Commits)
                            {
                                <tr>
                                    <td nowrap>@commit.RepositoryFriendlyName</td>
                                    @if (@commit.CommitterWhen.ToString("dd MMM yyy") == DateTime.Now.ToString("dd MMM yyy"))
                                    {
                                        <td nowrap>@commit.CommitterWhen.ToString("HH:mm") </td>
                                    }
                                    else if (@commit.CommitterWhen > DateTime.UtcNow.AddDays(-7))
                                    {
                                        <td nowrap>@commit.CommitterWhen.ToString("ddd HH:mm") </td>
                                    }
                                    else
                                    {
                                        <td nowrap>@commit.CommitterWhen.ToString("dd MMM") </td>
                                    }
                                    <td nowrap>@commit.Author</td>
                                    @if (string.IsNullOrWhiteSpace(@commit.CommitUrl))
                                    {
                                        <td>@commit.Sha.Substring(0, 7)</td>
                                    }
                                    else
                                    {
                                        <td><a href="@commit.CommitUrl" target="_blank">@commit.Sha.Substring(0, 7)</a></td>
                                    }
                                    <td>@commit.Message</td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    </div>
                    @foreach (var mp in @Model.Repositories)
                    {
                        if (mp.CommitCount > 0)
                        {
                            <div class="tab-pane fade" id="@mp.FriendlyName">
                                <table class="table table-striped table-hover">
                                    <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>User</th>
                                        <th>Commit</th>
                                        <th class="col-md-12">Message</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    @foreach (var commit in @Model.Commits)
                                    {
                                        if (@mp.FriendlyName == @commit.RepositoryFriendlyName)
                                        {
                                            <tr>
                                                @if (@commit.CommitterWhen > DateTime.Now.AddDays(-7))
                                                {
                                                    <td nowrap>@commit.CommitterWhen.ToString("ddd HH:mm") </td>
                                                }
                                                else
                                                {
                                                    <td nowrap>@commit.CommitterWhen.ToString("dd MMM") </td>
                                                }
                                                <td nowrap>@commit.Author</td>
                                                @if (string.IsNullOrWhiteSpace(@commit.CommitUrl))
                                                {
                                                    <td>@commit.Sha.Substring(0, 7)</td>
                                                }
                                                else
                                                {
                                                    <td><a href="@commit.CommitUrl" target="_blank">@commit.Sha.Substring(0, 7)</a></td>
                                                }
                                                <td>@commit.Message</td>
                                            </tr>
                                        }
                                    }
                                    </tbody>
                                </table>
                            </div>
                        }
                    }
                </div>
            }
        </div>
    </div>
</div>
